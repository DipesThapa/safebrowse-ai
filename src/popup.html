<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Safeguard</title>
  <link rel="stylesheet" href="popup.css">
</head>
<body>
  <header class="header">
    <div class="header__logo"><img src="../assets/icons/icon48.png" alt="Safeguard logo"></div>
    <div>
      <h1 class="header__title">Safeguard</h1>
      <p class="header__subtitle">On-device protection for safer browsing</p>
    </div>
    <div class="header__actions">
      <button id="themeToggle" class="theme-toggle" type="button" aria-label="Toggle theme">
        <span id="themeToggleIcon" aria-hidden="true">üåô</span>
      </button>
      <span id="statusBadge" class="status-badge">Active</span>
    </div>
</header>

<div class="parent-toggle">
  <button id="parentModeBtn" class="button button--secondary parent-toggle__button" type="button">Parent mode</button>
  <button id="classroomModeBtn" class="button button--secondary parent-toggle__button" type="button">Classroom mode</button>
</div>
<button id="parentBackBtn" class="button button--secondary parent-back" type="button" hidden>‚Üê Back</button>

<main>
    <section class="card" id="cardParent" hidden>
      <h2 class="card__title">Parent mode</h2>
      <p class="card__subtitle">Quick access to safeguarding controls for guardians and DSLs.</p>
      <div class="parent-panel">
        <div class="parent-panel__row" id="parentProfilesRow">
          <div>
            <h3 class="parent-panel__title">Profiles</h3>
            <p id="parentProfileStatus" class="parent-panel__status">Loading‚Ä¶</p>
          </div>
            <button id="parentProfilesBtn" class="button button--secondary" type="button">Manage</button>
        </div>
        <div class="parent-panel__row" id="parentOverrideRow">
          <div>
            <h3 class="parent-panel__title">Override log</h3>
            <p id="parentOverrideStatus" class="parent-panel__status">Loading‚Ä¶</p>
          </div>
          <button id="parentOverrideBtn" class="button button--secondary" type="button">Review</button>
        </div>
        <div class="parent-panel__row" id="parentFocusRow">
          <div>
            <h3 class="parent-panel__title">Focus Mode</h3>
            <p id="parentFocusStatus" class="parent-panel__status">Loading‚Ä¶</p>
          </div>
          <button id="parentFocusBtn" class="button button--secondary" type="button">Manage</button>
        </div>
        <div class="parent-panel__row" id="parentAllowlistRow">
          <div>
            <h3 class="parent-panel__title">Allowlist</h3>
            <p id="parentAllowlistStatus" class="parent-panel__status">Loading‚Ä¶</p>
          </div>
          <button id="parentAllowlistBtn" class="button button--secondary" type="button">Manage</button>
        </div>
        <div class="parent-panel__row" id="parentBlocklistRow">
          <div>
            <h3 class="parent-panel__title">Custom blocklist</h3>
            <p id="parentBlocklistStatus" class="parent-panel__status">Loading‚Ä¶</p>
          </div>
          <button id="parentBlocklistBtn" class="button button--secondary" type="button">Manage</button>
        </div>
        <div class="parent-panel__row" id="parentAlertsRow">
          <div>
            <h3 class="parent-panel__title">Override alerts</h3>
            <p id="parentAlertsStatus" class="parent-panel__status">Loading‚Ä¶</p>
          </div>
          <button id="parentAlertsBtn" class="button button--secondary" type="button">Configure</button>
        </div>
        <div class="parent-panel__row" id="parentTamperRow">
          <div>
            <h3 class="parent-panel__title">Tamper alerts</h3>
            <p id="parentTamperStatus" class="parent-panel__status">Loading‚Ä¶</p>
          </div>
          <button id="parentTamperBtn" class="button button--secondary" type="button">Configure</button>
        </div>
        <div class="parent-panel__row" id="parentDigestRow">
          <div>
            <h3 class="parent-panel__title">Safeguarding digest</h3>
            <p id="parentDigestStatus" class="parent-panel__status">Loading‚Ä¶</p>
          </div>
          <button id="parentDigestBtn" class="button button--secondary" type="button">Download</button>
        </div>
        <div class="parent-panel__row" id="parentApproverRow">
          <div>
            <h3 class="parent-panel__title">Approver prompt</h3>
            <p id="parentApproverStatus" class="parent-panel__status">Loading‚Ä¶</p>
          </div>
          <button id="parentApproverBtn" class="button button--secondary" type="button">Open</button>
        </div>
      </div>
      <div class="parent-section" id="parentProfilesSection" hidden>
        <div class="parent-section__header">
          <div>
            <h3 class="parent-section__title">Profiles</h3>
            <p class="parent-section__status">Apply age-based presets. This overwrites current allowlists and blocklists.</p>
          </div>
        </div>
        <div id="profileList" class="profile-list"></div>
        <small id="profileMessage" class="message">Select a profile to preview recommended settings.</small>

        <div id="profileDetails" class="profile-details" hidden>
          <p id="profileDescription" class="profile-details__desc"></p>
          <div id="profileSummary" class="profile-summary"></div>
        </div>

        <div class="actions actions--wrap">
          <button id="profileApply" class="button button--primary" type="button" disabled>Apply profile</button>
          <button id="profileReset" class="button button--link actions__end" type="button">Clear selection</button>
        </div>
      </div>
      <div class="parent-section" id="parentOverrides" hidden>
        <div class="parent-section__header">
          <div>
            <h3 class="parent-section__title">Override log</h3>
            <p class="parent-section__status">Reasons for manual overrides stay on this device for safeguarding reviews.</p>
          </div>
        </div>
        <ul id="overrideList" class="log-list"></ul>
        <small id="overrideMessage" class="message">No overrides recorded yet.</small>
        <div class="actions actions--wrap">
          <button id="overrideExport" class="button button--secondary" type="button">Download log</button>
          <button id="overrideClear" class="button button--link actions__end" type="button">Clear log</button>
        </div>
      </div>
      <div class="parent-section" id="parentAllowlistSection" hidden>
        <div class="parent-section__header">
          <div>
            <h3 class="parent-section__title">Allowlist</h3>
            <p class="parent-section__status">Bypass filtering for trusted domains (e.g. intranet portals).</p>
          </div>
        </div>
        <div class="field">
          <input id="allowHost" type="text" placeholder="example.com">
          <button id="addAllow" class="button button--primary" type="button">Add</button>
        </div>
        <small id="allowMessage" class="message">Enter hostnames without http/https.</small>
        <ul id="allowList" class="pill-list"></ul>
        <div class="actions actions--wrap">
          <button id="allowUpload" class="button button--secondary" type="button">Upload list</button>
          <button id="allowExport" class="button button--secondary" type="button">Download</button>
          <button id="clearAllow" class="button button--link actions__end" type="button">Clear allowlist</button>
        </div>
        <input id="allowFileInput" type="file" accept=".txt,.csv,.json" hidden>
      </div>
      <div class="parent-section" id="parentBlocklistSection" hidden>
        <div class="parent-section__header">
          <div>
            <h3 class="parent-section__title">Custom blocklist</h3>
            <p class="parent-section__status">Import policy domains that should always be blocked.</p>
          </div>
        </div>
        <textarea id="blocklistInput" placeholder="one domain per line (example.com)"></textarea>
        <small id="blockMessage" class="message">Paste or import domains to replace the current list.</small>
        <div class="actions actions--wrap">
          <button id="importBlocklist" class="button button--primary" type="button">Import / Replace</button>
          <button id="blockUpload" class="button button--secondary" type="button">Upload file</button>
          <button id="exportBlocklist" class="button button--secondary" type="button">Download</button>
          <button id="clearBlocklist" class="button button--link actions__end" type="button">Clear</button>
          <span id="blockCount" class="badge">0 domains</span>
        </div>
        <input id="blockFileInput" type="file" accept=".txt,.csv,.json" hidden>
      </div>
      <div class="parent-section" id="parentAlertsSection" hidden>
        <div class="parent-section__header">
          <div>
            <h3 class="parent-section__title">Override alerts</h3>
            <p class="parent-section__status">Send webhooks when PIN overrides or tamper events occur.</p>
          </div>
        </div>
        <div class="alert-config">
          <label class="toggle">
            <input id="alertEnabled" type="checkbox">
            <span>
              <span class="toggle__label">Send override alerts</span>
              <span class="toggle__hint">Notify DSLs via webhook (Slack, Teams, etc.) when a PIN override is approved.</span>
            </span>
          </label>
          <div id="alertForm" class="alert-form">
            <input id="alertWebhook" type="text" placeholder="https://hooks.slack.com/...">
            <button id="alertSave" class="button button--secondary" type="button">Save webhook</button>
          </div>
          <small id="alertMessage" class="message">Alerts stay on-device until you provide a webhook.</small>
          <label class="toggle">
            <input id="tamperAlertEnabled" type="checkbox">
            <span>
              <span class="toggle__label">Tamper alerts</span>
              <span class="toggle__hint">Send a webhook alert if Safeguard goes offline or is disabled for a while.</span>
            </span>
          </label>
          <small id="tamperMessage" class="message">Tamper alerts monitor for missed heartbeats.</small>
        </div>
        <small id="alertPlaceholder" class="message message--error" hidden>Apply a safeguarding profile to unlock alerting.</small>
      </div>
      <div class="parent-section" id="parentDigestSection" hidden>
        <div class="parent-section__header">
          <div>
            <h3 class="parent-section__title">Safeguarding digest</h3>
            <p class="parent-section__status">Generate a CSV summary for safeguarding meetings or audit trails.</p>
          </div>
        </div>
        <div class="actions actions--wrap">
          <button id="digestDownload" class="button button--primary" type="button">Download weekly digest</button>
        </div>
        <small id="digestMessage" class="message">Digest highlights settings, allow/block counts and recent overrides.</small>
      </div>
      <div class="parent-section" id="parentFocusSection" hidden>
        <div class="parent-section__header">
          <div>
            <h3 class="parent-section__title">Focus Mode</h3>
            <p class="parent-section__status">Kid Homework Mode ‚Äî block social/gaming/streaming and allow only educational sites.</p>
          </div>
        </div>
        <label class="toggle">
          <input id="focusToggle" type="checkbox">
          <span>
            <span class="toggle__label">Enable Focus Mode</span>
            <span class="toggle__hint">Starts a timed homework session across every tab.</span>
          </span>
        </label>

        <div class="focus-grid">
          <div class="focus-durations" id="focusDurations">
            <label class="select-label" for="focusDurationSelect">Session length</label>
            <div class="select">
              <select id="focusDurationSelect">
                <option value="30">30 minutes</option>
                <option value="45">45 minutes</option>
                <option value="60">60 minutes</option>
                <option value="2">2 minutes (test)</option>
              </select>
            </div>
          </div>
          <div class="focus-status">
            <div>
              <p id="focusCountdown" class="focus-countdown">Focus Mode is off</p>
              <p id="focusEta" class="focus-eta">Duration 45 minutes</p>
            </div>
            <button id="focusEnd" class="button button--secondary" type="button">End early</button>
          </div>
        </div>

        <label class="toggle">
          <input id="focusPin" type="checkbox">
          <span>
            <span class="toggle__label">Require PIN to end early</span>
            <span class="toggle__hint">Prevents kids from turning off Focus Mode without approval.</span>
          </span>
        </label>

        <p class="focus-note">
          Social media, gaming, and streaming are blocked. Wikipedia, Khan Academy, .edu/.org domains, and your allowlist stay open.
        </p>
        <small id="focusMessage" class="message">Pick a duration and start homework mode.</small>
      </div>
      <div class="parent-section" id="parentClassroomSection" hidden>
        <div class="parent-section__header">
          <div>
            <h3 class="parent-section__title">Classroom mode</h3>
            <p class="parent-section__status">One click to lock social/gaming, strict SafeSearch, and YouTube only via classroom playlists.</p>
          </div>
        </div>
        <label class="toggle">
          <input id="classroomToggle" type="checkbox">
          <span>
            <span class="toggle__label">Enable Classroom mode</span>
            <span class="toggle__hint">Blocks social/gaming, pauses YouTube unless on an approved playlist, and disables overrides.</span>
          </span>
        </label>
        <div class="field field--stack">
          <label class="field__label" for="classroomPlaylists">Allowed YouTube playlist IDs or URLs (one per line)</label>
          <textarea id="classroomPlaylists" placeholder="PL1234567890abcdef..."></textarea>
        </div>
        <div class="actions actions--wrap">
          <button id="classroomSave" class="button button--secondary" type="button">Save allowlist</button>
        </div>
        <div class="pill-wrap">
          <div class="pill-wrap__header">
            <span class="pill-wrap__title">Saved playlists</span>
            <span class="pill-wrap__hint">Remove to block again.</span>
          </div>
          <ul id="classroomPlaylistList" class="pill-list"></ul>
          <small id="classroomPlaylistEmpty" class="message">No playlists saved yet.</small>
        </div>
        <small id="classroomMessage" class="message">No playlists saved yet; YouTube will stay blocked in Classroom mode.</small>
      </div>
    </section>

    <section class="card" id="cardProtection">
      <h2 class="card__title">Protection</h2>
      <p class="card__subtitle">Control network filtering and visual safeguards for every site.</p>

      <label class="toggle">
        <input id="enabled" type="checkbox">
        <span>
          <span class="toggle__label">Enable protection</span>
          <span class="toggle__hint">Blocks adult domains and suspicious media automatically.</span>
        </span>
      </label>

      <label class="toggle">
        <input id="siteToggle" type="checkbox" disabled>
        <span>
          <span class="toggle__label">Allow this site</span>
          <span class="toggle__hint">Bypass filtering for <strong id="siteHost">loading‚Ä¶</strong>.</span>
        </span>
      </label>

      <label class="toggle">
        <input id="aggressive" type="checkbox">
        <span>
          <span class="toggle__label">Aggressive mode</span>
          <span class="toggle__hint">Blur and pause explicit images/videos detected on the page.</span>
        </span>
      </label>

      <label class="toggle">
        <input id="nudgeEnabled" type="checkbox">
        <span>
          <span class="toggle__label">Healthy nudges</span>
          <span class="toggle__hint">Gentle reminders for breaks and staying on track. All on-device.</span>
        </span>
      </label>

      <label class="toggle">
        <input id="requirePin" type="checkbox">
        <span>
          <span class="toggle__label">Require PIN for overrides</span>
          <span class="toggle__hint">Ask for a private PIN before ‚ÄúContinue anyway‚Äù works.</span>
        </span>
      </label>

      <div id="pinControls" class="pin-controls">
        <div class="actions actions--wrap">
          <button id="pinUpdate" class="button button--primary" type="button">Set PIN</button>
          <button id="pinRemove" class="button button--link actions__end" type="button">Remove PIN</button>
        </div>
        <small id="pinMessage" class="message">Protect manual overrides with a PIN that stays on this device.</small>
      </div>

      <div class="slider">
        <div class="slider__label">Sensitivity <span id="sensitivityValue" class="slider__value">60</span></div>
        <input id="sensitivity" type="range" min="10" max="100" step="1" value="60">
      </div>

      <div class="metrics" aria-label="policy metrics">
        <div class="metrics__item">
          <span id="metricAllowed" class="metrics__value">0</span>
          <span class="metrics__label">Allowlisted</span>
        </div>
        <div class="metrics__item">
          <span id="metricBlocked" class="metrics__value">0</span>
          <span class="metrics__label">Policy blocks</span>
        </div>
      </div>
    </section>
    <section class="card" id="cardApprover" hidden>
      <h2 class="card__title">Override approvers</h2>
      <p class="card__subtitle">Collect initials/names when PIN overrides happen for audit trails.</p>
      <label class="toggle">
        <input id="approverPromptEnabled" type="checkbox">
        <span>
          <span class="toggle__label">Require approver name</span>
          <span class="toggle__hint">Prompt for staff initials/name whenever a PIN override is approved.</span>
        </span>
      </label>
      <small id="approverMessage" class="message">Enable to capture who approves each override. Names stay on this device.</small>
    </section>
  </main>

  <footer class="footer">
    <div class="footer__links">
      <a href="../site/index.html" target="_blank" rel="noopener">Product Guide</a>
      <a href="../site/privacy.html" target="_blank" rel="noopener">Privacy</a>
      <a href="../site/support.html" target="_blank" rel="noopener">Support</a>
    </div>
    <button type="button" id="tourReplay" class="button button--link">Show tour</button>
  </footer>

  <div id="tour" class="tour tour--hidden" role="dialog" aria-modal="true" aria-labelledby="tourTitle">
    <div class="tour__panel">
      <div class="tour__progress" id="tourProgress">Step 1 of 3</div>
      <h2 id="tourTitle" class="tour__title">Welcome to Safeguard</h2>
      <p id="tourBody" class="tour__body">Safeguard blocks adult content and risky ads before they appear.</p>
      <div class="tour__actions">
        <button type="button" id="tourSkip" class="button button--secondary">Skip tour</button>
        <button type="button" id="tourNext" class="button button--primary">Next</button>
      </div>
    </div>
  </div>

  <div id="pinModal" class="modal modal--hidden" role="dialog" aria-modal="true" aria-labelledby="pinModalTitle">
    <div class="modal__panel">
      <h3 id="pinModalTitle" class="modal__title">Enter PIN</h3>
      <p id="pinModalMessage" class="modal__message"></p>
      <div class="modal__field">
        <label for="pinModalInput">PIN (4-8 digits)</label>
        <input id="pinModalInput" type="password" inputmode="numeric" pattern="\\d{4,8}" maxlength="8" autocomplete="off" aria-label="PIN">
      </div>
      <div id="pinModalConfirmGroup" class="modal__field modal__field--hidden">
        <label for="pinModalConfirm">Confirm PIN</label>
        <input id="pinModalConfirm" type="password" inputmode="numeric" pattern="\\d{4,8}" maxlength="8" autocomplete="off" aria-label="Confirm PIN">
      </div>
      <div id="pinModalError" class="modal__error" aria-live="polite"></div>
      <div class="modal__actions">
        <button type="button" id="pinModalCancel" class="button button--secondary">Cancel</button>
        <button type="button" id="pinModalSubmit" class="button button--primary">Continue</button>
      </div>
    </div>
  </div>

  <script src="popup.js"></script>
</body>
</html>
